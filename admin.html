<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RightClick Admin Panel</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css">
</head>
<body class="bg-gray-50 font-sans">

  <!-- HEADER -->
  <header class="bg-white shadow p-4 flex items-center">
    <img src="https://github.com/keerthynaidu4u-netizen/rightclick-crm/blob/main/logo.png" alt="Logo" class="h-10 w-10 mr-4">
    <div class="flex flex-col">
      <span class="text-xl font-bold">Admin Panel</span>
      <span class="text-gray-600 text-sm">RightClick Computers Services</span>
    </div>
  </header>

  <!-- MAIN TABLE -->
  <main class="p-4">
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300">
        <thead class="bg-gray-200">
          <tr>
            <th class="px-2 py-1 border">Job ID</th>
            <th class="px-2 py-1 border">Customer Name</th>
            <th class="px-2 py-1 border">Phone</th>
            <th class="px-2 py-1 border">Date & Time</th>
            <th class="px-2 py-1 border">Device Type</th>
            <th class="px-2 py-1 border">Device Name</th>
            <th class="px-2 py-1 border">Device ID</th>
            <th class="px-2 py-1 border">Accessories</th>
            <th class="px-2 py-1 border">Accessories Description</th>
            <th class="px-2 py-1 border">Estimation</th>
            <th class="px-2 py-1 border">Diagnosis</th>
            <th class="px-2 py-1 border">Status</th>
            <th class="px-2 py-1 border">Action</th>
          </tr>
        </thead>
        <tbody id="adminTableBody">
          <!-- Dynamic rows will be added here -->
        </tbody>
      </table>
    </div>
  </main>

  <!-- SCRIPT -->
  <script>
    // === Replace this with your Web App URL from Google Apps Script ===
    const SHEET_API_URL = "YOUR_WEB_APP_URL_HERE";

    async function fetchJobs() {
      try {
        const response = await fetch(SHEET_API_URL);
        const jobs = await response.json();

        if(jobs.error) {
          console.error("Error from API:", jobs.error);
          alert("Error fetching jobs: " + jobs.error);
          return;
        }

        renderAdminTable(jobs);
      } catch (error) {
        console.error("Error fetching jobs:", error);
        alert("Error fetching jobs. Check console.");
      }
    }

    function renderAdminTable(jobs) {
      const tableBody = document.getElementById("adminTableBody");
      tableBody.innerHTML = ""; // clear previous

      jobs.forEach(job => {
        const row = document.createElement("tr");
        row.classList.add("border-b");

        row.innerHTML = `
          <td class="px-2 py-1 border">${job.JobID || ""}</td>
          <td class="px-2 py-1 border">${job.CustomerName || ""}</td>
          <td class="px-2 py-1 border">${job.Phone || ""}</td>
          <td class="px-2 py-1 border">${job.DateTimeReceived || ""}</td>
          <td class="px-2 py-1 border">${job.DeviceType || ""}</td>
          <td class="px-2 py-1 border">${job.DeviceName || ""}</td>
          <td class="px-2 py-1 border">${job.DeviceID || ""}</td>
          <td class="px-2 py-1 border">${job.Accessories || ""}</td>
          <td class="px-2 py-1 border">${job.AccessoriesDescription || ""}</td>
          <td class="px-2 py-1 border">${job.Estimation || ""}</td>
          <td class="px-2 py-1 border">${job.Diagnosis || ""}</td>
          <td class="px-2 py-1 border">
            <select class="border px-1 py-0.5" onchange="updateStatus('${job.JobID}', this.value)">
              <option value="Received" ${job.Status==='Received'?'selected':''}>Received</option>
              <option value="In Progress" ${job.Status==='In Progress'?'selected':''}>In Progress</option>
              <option value="Ready" ${job.Status==='Ready'?'selected':''}>Ready</option>
              <option value="Delivered" ${job.Status==='Delivered'?'selected':''}>Delivered</option>
            </select>
          </td>
          <td class="px-2 py-1 border">
            <button class="bg-blue-500 text-white px-2 py-1 rounded mt-1" onclick="sendUpdateWhatsApp('${job.JobID}')">Send Update</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Placeholder functions for future WhatsApp integration
    function updateStatus(jobId, newStatus) {
      console.log(`Job ${jobId} updated to status: ${newStatus}`);
      // TODO: Connect to Google Sheet or backend to update status
    }

    function sendUpdateWhatsApp(jobId) {
      console.log(`Send WhatsApp for Job ${jobId}`);
      // TODO: Open Click-to-WhatsApp link with prefilled message
    }

    // Fetch jobs on page load
    fetchJobs();
  </script>
</body>
</html>
