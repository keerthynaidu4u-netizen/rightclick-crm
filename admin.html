<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>RightClick Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
.header{display:flex;align-items:center;background:#fff;padding:10px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
.header img{height:40px}
.header div{margin-left:10px}
.job-card{background:#fff;margin:10px;padding:10px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}
.job-card p{margin:4px 0;font-size:14px}
select{width:100%;padding:6px;margin-top:5px}
</style>
</head>
<body>

<div class="header">
<img src="https://raw.githubusercontent.com/keerthynaidu4u-netizen/rightclick-crm/main/logo.png">
<div>
<b>Admin Panel</b><br>
<small>RightClick Computers Services</small>
</div>
</div>

<div id="jobs"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzdwEAtfdDdKtvcp5lyLvqlo0aK4dyR_5M675mjoy0UJvr3SGMsUI7CBZVEld1tYSW1Nw/exec";
const OWNER_NUMBER = "919059895427";
const TRACK_LINK = "PUT_YOUR_TRACK_PAGE_LINK_HERE";

fetch(API_URL)
.then(r=>r.json())
.then(data=>render(data))
.catch(e=>alert("Error fetching data"));

function render(data){
  const box=document.getElementById("jobs");
  box.innerHTML="";
  data.forEach(job=>{
    box.innerHTML+=`
    <div class="job-card">
      <p><b>Job ID:</b> ${job.JobID}</p>
      <p><b>Name:</b> ${job.CustomerName}</p>
      <p><b>Phone:</b> ${job.Phone}</p>
      <p><b>Device:</b> ${job.DeviceType} ${job.DeviceName}</p>
      <p><b>Estimation:</b> ${job.Estimation}</p>
      <p><b>Diagnosis:</b> ${job.Diagnosis}</p>
      <p><b>Status:</b></p>
      <select onchange='updateStatus("${job.JobID}",this.value,${JSON.stringify(job)})'>
        <option ${job.Status=="Received"?"selected":""}>Received</option>
        <option ${job.Status=="In Progress"?"selected":""}>In Progress</option>
        <option ${job.Status=="Ready"?"selected":""}>Ready</option>
        <option ${job.Status=="Delivered"?"selected":""}>Delivered</option>
      </select>
    </div>`;
  })
}

function updateStatus(id,status,job){
fetch(API_URL,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({JobID:id,Status:status})
})
.then(r=>r.json())
.then(()=>{
  // CUSTOMER
  let cmsg = encodeURIComponent(
`RIGHTCLICK COMPUTERS
Job ID: ${job.JobID}
Name: ${job.CustomerName}
Device: ${job.DeviceType} ${job.DeviceName}
Estimation: ${job.Estimation}
Diagnosis: ${job.Diagnosis}
Status: ${status}

Track: ${TRACK_LINK}`
);
window.open(`https://wa.me/${job.Phone}?text=${cmsg}`);

  // OWNER
  let omsg = encodeURIComponent(
`RIGHTCLICK ADMIN UPDATE
Job ID: ${job.JobID}
Customer: ${job.CustomerName}
Phone: ${job.Phone}
Estimation: ${job.Estimation}
Diagnosis: ${job.Diagnosis}
Status changed to: ${status}`
);
window.open(`https://wa.me/${OWNER_NUMBER}?text=${omsg}`);
})
.catch(()=>alert("Status update failed"));
}
</script>

</body>
</html>
